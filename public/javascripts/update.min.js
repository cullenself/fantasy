function attachEvents(){$('table#top').click(a=>{a.stopPropagation();const b=$(a.target);b.closest('td').hasClass('hidden')?b.closest('td').slideToggle():b.closest('tr.main').children('td').hasClass('hidden')?b.closest('tr.main').children('td').slideToggle():b.closest('tr.main').next().children('.hidden').slideToggle()})}async function render(a){const b=Mustache.render(window.tableTemplate,{score:a.score}),c=Mustache.render(window.footerTemplate,{timestamp:new Date(a.stats.timestamp).toLocaleString('en-US',{weekday:'short',month:'long',day:'numeric',hour:'numeric',minute:'numeric',timeZoneName:'short'})});return $('tbody#table-target').html(b),$('div#footer-target').html(c),$('td.hidden').hide(),a}function removeOverlay(){$('.spinner-center').removeClass('active'),$('.card-panel').removeClass('overlay')}async function updateScore(a){const b=await $.getJSON('/stats?callback=?');return Date(b.timestamp)>Date(a.stats.timestamp)&&(Object.values(a.score).forEach(a=>{Object.values(a.pros).forEach(a=>{a.wins=b.pro_teams.find(b=>b.name===a.name).wins})}),a.score.sort((a,b)=>b.wins-a.wins),a.stats.timestamp=b.timestamp),a}async function loadCache(){return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/javascripts/stats.json'),$.getJSON('/javascripts/next.json')]).catch(a=>{if(404===a.status)return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/stats?callback=?'),$.getJSON('/next?callback=?')]);throw a}).then(a=>{const b=a[0],c=a[1],d=a[2],e=[];return Object.keys(b).forEach(a=>{const f={part:a,wins:0,pros:[]};Object.values(b[a]).forEach(a=>{const b=c.pro_teams.find(b=>b.name===a);let e=d.games.find(a=>a.homeAbbreviation===b.abbreviation);void 0===e?(e=d.games.find(a=>a.awayAbbreviation===b.abbreviation),b.next=`${e.awayAbbreviation} @ ${e.homeAbbreviation}`):b.next=`${e.homeAbbreviation} vs. ${e.awayAbbreviation}`,f.pros.push(b)}),f.wins=f.pros.reduce((a,b)=>a+b.wins,0),e.push(f)}),e.sort((a,b)=>b.wins-a.wins),{score:e,stats:c}})}function loadTable(){window.tableTemplate=$('script#table-template').html(),Mustache.parse(window.tableTemplate),window.footerTemplate=$('script#footer-template').html(),loadCache().then(render).then(updateScore).then(render).then(()=>{attachEvents(),removeOverlay()})}