function attachEvents(){$('table#top').click(a=>{a.stopPropagation();const b=$(a.target);b.closest('td').hasClass('hidden')?b.closest('td').slideToggle():b.closest('tr.main').children('td').hasClass('hidden')?b.closest('tr.main').children('td').slideToggle():b.closest('tr.main').next().children('.hidden').slideToggle()})}async function render(a){const b=Mustache.render(window.tableTemplate,{score:a.score}),c=Mustache.render(window.footerTemplate,{timestamp:new Date(a.sched.timestamp).toLocaleString('en-US',{weekday:'short',month:'long',day:'numeric',hour:'numeric',minute:'numeric',timeZoneName:'short'})});return $('tbody#table-target').html(b),$('div#footer-target').html(c),$('td.hidden').hide(),a}function removeOverlay(){$('.spinner-center').removeClass('active'),$('.card-panel').removeClass('overlay')}async function loadCache(){return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/javascripts/stats.json'),$.getJSON('/javascripts/sched.json')]).catch(a=>{if(404===a.status)return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/stats?callback=?'),$.getJSON('/sched?callback=?')]).catch(a=>{if('undefined'===a.responseText)return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/stats?callback=?')]);throw a});throw a}).then(a=>{const b=a[0],c=a[1],d=a[2];return{teams:b,stats:c,sched:d}})}function calcScore(a){const b=[],c={weekday:'short',hour:'numeric',minute:'numeric'};return Object.keys(a.teams).forEach(d=>{const e={part:d,wins:0,pros:[]};Object.values(a.teams[d]).forEach(b=>{const d=a.stats.pro_teams.find(a=>a.name===b);if(a.sched){let b=a.sched.games.find(a=>a.homeAbbreviation===d.abbreviation);const e=void 0!==b;if(b=b||a.sched.games.find(a=>a.awayAbbreviation===d.abbreviation),void 0!==b){const a=e?'vs.':'@',f=e?b.awayAbbreviation:b.homeAbbreviation;let g=`${Math.max(b.homeScore,b.awayScore)}-${Math.min(b.homeScore,b.awayScore)}`,h=e==b.homeScore>b.awayScore;const i=b.homeScore===b.awayScore;let j;switch(b.complete){case'UNPLAYED':j=new Date(b.gametime).toLocaleDateString('en-US',c),h='',g='';break;case'LIVE':j=`${b.quarter}${['st','nd','rd','th'][b.quarter-1]} Quarter`,5===b.quarter&&(j='Overtime'),h=h?'Up':'Down',h=i?'Tied':h;break;case'COMPLETED_PENDING_REVIEW':h&&(d.wins+=1);default:j='',h=h?'W':'L',h=i?'Tied':h;}d.nextGame=`${h} ${g} ${a} ${f} ${j}`}else d.nextGame='Bye'}e.pros.push(d)}),e.pros.sort((a,b)=>b.wins-a.wins),e.wins=e.pros.reduce((a,b)=>a+b.wins,0),b.push(e)}),b.sort((a,b)=>b.wins-a.wins),a.score=b,a}async function updateSched(a){const b=await $.getJSON('/sched?callback=?').catch(a=>{if('undefined'!==a.responseText)throw a});return b&&(!a.sched||Date(b.timestamp)>Date(a.sched.timestamp))?b:void 0}async function updateStats(a){const b=await $.getJSON('/stats?callback=?').catch(a=>{if('undefined'!==a.responseText)throw a});return b&&(!a.stats||Date(b.timestamp)>Date(a.stats.timestamp))?b:void 0}async function update(a){return Promise.all([updateStats(a),updateSched(a)]).then(b=>{const c=b[0],d=b[1];return c&&(a.stats=c),d&&(a.sched=d),c||d?render(calcScore(a)):a})}function loadTable(){window.tableTemplate=$('script#table-template').html(),Mustache.parse(window.tableTemplate),window.footerTemplate=$('script#footer-template').html(),loadCache().then(calcScore).then(render).then(update).then(()=>{attachEvents(),removeOverlay()})}