function attachEvents(){$('table#top').click(a=>{a.stopPropagation();const b=$(a.target);b.closest('td').hasClass('hidden')?b.closest('td').slideToggle():b.closest('tr.main').children('td').hasClass('hidden')?b.closest('tr.main').children('td').slideToggle():b.closest('tr.main').next().children('.hidden').slideToggle()})}async function render(a){const b=Mustache.render(window.tableTemplate,{score:a.score}),c=Mustache.render(window.footerTemplate,{timestamp:new Date(a.stats.timestamp).toLocaleString('en-US',{weekday:'short',month:'long',day:'numeric',hour:'numeric',minute:'numeric',timeZoneName:'short'})});return $('tbody#table-target').html(b),$('div#footer-target').html(c),$('td.hidden').hide(),a}function removeOverlay(){$('.spinner-center').removeClass('active'),$('.card-panel').removeClass('overlay')}async function updateNext(a){const b=await $.getJSON('/next?callback=?');return Date(b.timestamp)>Date(a.next.timestamp)?b:void 0}async function loadCache(){return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/javascripts/stats.json'),$.getJSON('/javascripts/next.json')]).catch(a=>{if(404===a.status)return Promise.all([$.getJSON('/javascripts/teams.json'),$.getJSON('/stats?callback=?'),$.getJSON('/next?callback=?')]);throw a}).then(a=>{const b=a[0],c=a[1],d=a[2];return{teams:b,stats:c,next:d}})}async function calcScore(a){const b=[],c={weekday:'short',hour:'numeric',minute:'numeric'};return Object.keys(a.teams).forEach(d=>{const e={part:d,wins:0,pros:[]};Object.values(a.teams[d]).forEach(b=>{const d=a.stats.pro_teams.find(a=>a.name===b);let f=a.next.games.find(a=>a.homeAbbreviation===d.abbreviation);void 0===f?(f=a.next.games.find(a=>a.awayAbbreviation===d.abbreviation),d.next=`@ ${f.homeAbbreviation}, ${new Date(f.gametime).toLocaleDateString('en-US',c)}`):d.next=`vs. ${f.awayAbbreviation}, ${new Date(f.gametime).toLocaleDateString('en-US',c)}`,e.pros.push(d)}),e.wins=e.pros.reduce((a,b)=>a+b.wins,0),b.push(e)}),b.sort((a,b)=>b.wins-a.wins),a.score=b,a}async function updateStats(a){const b=await $.getJSON('/stats?callback=?');return Date(b.timestamp)>Date(a.stats.timestamp)?b:void 0}async function update(a){return Promise.all([updateStats(a),updateNext(a)]).then(b=>{const c=b[0],d=b[0];return c&&(a.stats=c),d&&(a.next=d),c||d?calcScore(a):a})}function loadTable(){window.tableTemplate=$('script#table-template').html(),Mustache.parse(window.tableTemplate),window.footerTemplate=$('script#footer-template').html(),loadCache().then(calcScore).then(render).then(update).then(()=>{attachEvents(),removeOverlay()})}